autoscaling:
  enabled: false
  maxReplicas: 1
  minReplicas: 1

gitRepo: https://github.com/mauberti-bc/conservation-prioritization.git
gitRef: main
registry: image-registry.apps.gold.devops.gov.bc.ca/fa9440-tools

ports:
  frontend: 7070
  api: 5200
  prefect_server_api: 4200
  prefect_worker_api: 8081

prefect-server:
  serviceAccount:
    create: false
    name: prefect-server
  ui:
    enabled: true
    podSecurityContext:
      runAsUser: 1003600000
      fsGroup: null
    containerSecurityContext:
      runAsUser: 1003600000
      runAsNonRoot: true
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
          - ALL
    resources:
      requests:
        cpu: 50m
        memory: 128Mi
      limits:
        cpu: 50m
        memory: 128Mi
  server:
    podSecurityContext:
      runAsUser: 1003600000
      fsGroup: null

    containerSecurityContext:
      runAsUser: 1003600000
      runAsNonRoot: true
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
          - ALL

    resources:
      requests:
        cpu: 50m
        memory: 256Mi
      limits:
        cpu: 100m
        memory: 256Mi

    env:
      - name: PREFECT_SERVER_API_HOST
        value: "0.0.0.0"

  migrations:
    enabled: true
    backoffLimit: 3
    securityContext:
      runAsUser: 1003600000
  ingress:
    enabled: false
    host:
      hostname: conservation-tool-prefect-server-fa9440-dev.apps.gold.devops.gov.bc.ca
      path: /
    className: "openshift-default"
  postgresql:
    primary:
      podSecurityContext:
        runAsUser: 1003600000
        fsGroup: 1003600000
      containerSecurityContext:
        runAsUser: 1003600000
        runAsNonRoot: true
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: false
        capabilities:
          drop:
            - ALL
  backgroundServices:
    podSecurityContext:
      runAsUser: 1003600000
      fsGroup: null
    containerSecurityContext:
      runAsUser: 1003600000
      runAsNonRoot: true
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
          - ALL

services:
  frontend:
    replicas: 0

    image:
      stream: frontend
      tag: dev
      pullPolicy: "Always"

    service:
      type: ClusterIP
      port: 7070
      targetPort: 7070

    route:
      host: conservation123.nrs.gov.bc.ca

    securityContext:
      runAsUser: 1003600000
      fsGroup: 1003600000

    resources:
      requests:
        cpu: 50m
        memory: 256Mi
      limits:
        cpu: 100m
        memory: 256Mi

    livenessProbe:
      enabled: false
      path: "/health"
      initialDelaySeconds: 30
      periodSeconds: 10

    readinessProbe:
      enabled: false
      path: "/health"
      initialDelaySeconds: 5
      periodSeconds: 5

    extraVolumeMounts: []
    extraVolumes: []

  workflows:
    worker:
      replicas: 0
      pool: pool
      image:
        stream: prefect-worker
        tag: dev
        pullPolicy: IfNotPresent
      resources:
        limits:
          cpu: 100m
          memory: 1028Mi
        requests:
          cpu: 50m
          memory: 1028Mi
      service:
        type: ClusterIP
        port: 80
        targetPort: 8081
      securityContext:
        runAsUser: 1003600000
        fsGroup: 1003600000

    deploy:
      replicas: 0
      image:
        stream: prefect-deploy
        tag: dev
        pullPolicy: IfNotPresent
      resources:
        requests:
          cpu: 50m
          memory: 1028Mi
        limits:
          cpu: 100m
          memory: 1028Mi
      securityContext:
        runAsUser: 1003600000
        fsGroup: 1003600000

env:
  NODE_OPTIONS: "--max-old-space-size=4096"
  ZARR_STORE_PATH: "/data/output_1000.zarr"
